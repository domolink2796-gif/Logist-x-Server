<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Logist Master HQ | v86.0</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #010409; color: #e6edf3; font-family: 'Inter', sans-serif; margin: 0; }
        .glass { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); border-radius: 2.5rem; }
        .btn-gold { background: linear-gradient(135deg, #f59e0b, #b45309); color: #000; font-weight: 900; }
        input { background: #000 !important; border: 1px solid #30363d !important; color: #fff !important; border-radius: 12px !important; padding: 14px !important; width: 100%; outline: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [isAuth, setIsAuth] = useState(false);
            const [pass, setPass] = useState("");
            const [keys, setKeys] = useState([]);
            const [loading, setLoading] = useState(false);

            const login = () => pass.toLowerCase() === 'евгений никитин' ? (setIsAuth(true), refresh()) : alert("Доступ закрыт");
            
            const refresh = async () => {
                setLoading(true);
                try {
                    const res = await fetch('/api/list_keys');
                    const data = await res.json();
                    setKeys(data.keys || []);
                } catch(e) { alert("Ошибка загрузки"); }
                setLoading(false);
            };

            const addKey = async (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                setLoading(true);
                await fetch('/api/add_key', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name: fd.get('o'), days: fd.get('d'), limit: fd.get('l') })
                });
                refresh();
                e.target.reset();
            };

            const deleteKey = async (key) => {
                if(!confirm('Удалить?')) return;
                await fetch('/api/delete_key', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ key })
                });
                refresh();
            };

            if (!isAuth) return (
                <div className="h-screen flex items-center justify-center p-6 bg-[#010409]">
                    <div className="glass p-12 w-full max-w-sm text-center">
                        <h1 className="text-3xl font-black mb-8 text-amber-500 italic uppercase">Logist HQ</h1>
                        <input type="password" value={pass} onChange={e=>setPass(e.target.value)} placeholder="Мастер Пароль" className="mb-4 text-center font-bold" onKeyDown={e=>e.key==='Enter'&&login()} />
                        <button onClick={login} className="btn-gold w-full py-5 rounded-2xl uppercase font-black text-[11px]">Войти</button>
                    </div>
                </div>
            );

            return (
                <div className="p-4 md:p-10 max-w-7xl mx-auto min-h-screen">
                    <header className="flex justify-between items-center mb-10 glass p-6">
                        <h1 className="text-xl font-black italic text-amber-500 uppercase">Master Control</h1>
                        <button onClick={refresh} className="bg-amber-500 text-black px-5 py-2 rounded-xl text-[10px] font-black uppercase">{loading ? "..." : "Обновить"}</button>
                    </header>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-2 space-y-4">
                            {keys.map(k => (
                                <div key={k.key} className="glass p-6">
                                    <div className="flex justify-between mb-4">
                                        <span className="font-mono text-amber-500 font-black text-xs">{k.key}</span>
                                        <button onClick={() => deleteKey(k.key)} className="text-red-500 text-[10px] uppercase font-black">Удалить</button>
                                    </div>
                                    <div className="text-2xl font-black uppercase">{k.name}</div>
                                    <div className="text-[10px] opacity-30 mb-6 uppercase italic">Лимит: {k.workers.length} / {k.limit}</div>
                                    <div className="flex flex-wrap gap-2">
                                        {k.workers.map(w => <span key={w} className="bg-white/5 px-3 py-1 rounded-lg text-[10px] font-bold border border-white/5">{w}</span>)}
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div>
                            <form onSubmit={addKey} className="glass p-8 sticky top-10">
                                <h2 className="text-center font-black uppercase text-[11px] text-amber-500 mb-8 tracking-widest italic">Новая Лицензия</h2>
                                <input name="o" placeholder="Название компании" required className="mb-4 font-bold" />
                                <div className="grid grid-cols-2 gap-4 mb-8">
                                    <input name="d" type="number" defaultValue="30" placeholder="Дней" />
                                    <input name="l" type="number" defaultValue="1" placeholder="Лимит" />
                                </div>
                                <button type="submit" className="btn-gold w-full py-5 rounded-2xl uppercase font-black text-[11px]">Выпустить ключ</button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>
